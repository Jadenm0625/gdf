<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Kingdom — Grounded + Parallax + Sky Arc (No Dup Decls)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
  <style>
    html,body{margin:0;height:100%;background:#0c0f14;overflow:hidden;font-family:system-ui,Segoe UI,Roboto,Arial}
    #game{width:100%;height:100%}
    .hud{position:fixed;left:12px;top:10px;color:#e9f4ff;text-shadow:0 1px 2px rgba(0,0,0,.6);font-size:16px;line-height:1.2;z-index:10}
    .hud b{font-weight:700}
    .err{position:fixed;right:12px;top:12px;max-width:44ch;padding:10px 12px;background:#2b1a1a;color:#ffd7d7;border:1px solid #a33;border-radius:8px;font-size:12px;z-index:9999;display:none;white-space:pre-wrap}
  </style>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.80.0/dist/phaser.min.js"></script>
</head>
<body>
<div class="hud" id="hud"></div>
<div class="err" id="errbox"></div>
<div id="game"></div>

<script>
/* On-screen error box */
(function(){
  const box = document.getElementById('errbox');
  window.onerror = function(msg, src, line, col, err){
    box.style.display = 'block';
    box.textContent = (msg||'Error') + '\n' + (src||'') + ':' + (line||'?') + ':' + (col||'?') + '\n' + (err && err.stack ? err.stack : '');
  };
  if (typeof Phaser === 'undefined'){
    box.style.display = 'block';
    box.textContent = 'Phaser failed to load. Check your internet connection (CDN).';
  }
})();
</script>

<script>
(() => {
  if (typeof Phaser === 'undefined') return;

  // ---------- CONFIG & CONSTANTS ----------
  const DESIGN_W = 1920, DESIGN_H = 1018;

  // World sizing (1 ft = 12 px baseline)
  const WORLD_FEET = 1000, WORLD_PX = WORLD_FEET*12; // 12,000 px
  const ENV_SCALE = 3;           // everything except the king is 3x
  const GROUND_BMP_H = 96;       // base ground art height (before scaling)
  const GROUND_STRIP_H = GROUND_BMP_H * ENV_SCALE;

  // Ground line we align everything to (top of ground strip)
  const GROUND_Y_CENTER = DESIGN_H - 120;                // ground sprite center
  const GROUND_TOP = GROUND_Y_CENTER - GROUND_STRIP_H/2; // y of surface

  // Stats & costs
  const PLAYER_MAX_HP = 15;
  const PEASANT_MAX_HP = 4;
  const ENEMY_MAX_HP = 3;
  const WALL_MAX_HP = 2;
  const DMG_ENEMY_HIT = 1;
  const COST_WALL = 2;
  const COST_RECRUIT = 1;

  // Day/Night speeds (1..10 scale) – smaller = faster
  const DAY_SPEED = 6;
  const NIGHT_SPEED = 4;
  const CYCLE_BASE = 0.08;

  const config = {
    type: Phaser.AUTO,
    parent: 'game',
    backgroundColor: '#0c0f14',
    scale: { mode: Phaser.Scale.FIT, autoCenter: Phaser.Scale.CENTER_BOTH, width: DESIGN_W, height: DESIGN_H },
    physics: { default: 'arcade', arcade: { gravity:
